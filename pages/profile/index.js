"use strict";function i(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return s(e,t)}(e))){var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw r}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}var e=document.querySelector(".header__mobile-menu_js"),t=document.querySelector(".mobile-header__button-close_js"),o=document.querySelector(".mobile-header");e.addEventListener("click",function(){o.classList.add("mobile-header_open")}),t.addEventListener("click",function(){o.classList.remove("mobile-header_open")});var r=document.querySelector(".modal_password-edit-js"),n=document.querySelector(".profile__button-password-js"),a=document.querySelector(".modal__close_password-edit-js"),d=document.querySelector(".form__input_sing-in-js");n.addEventListener("click",function(){r.classList.remove("modal_close"),d.focus()}),a.addEventListener("click",function(){r.classList.add("modal_close"),n.focus()}),window.addEventListener("keydown",function(e){r.classList.contains("modal_close")||"Escape"!==e.code||(r.classList.add("modal_close"),n.focus())});var l=document.querySelector(".modal_editing-data-js"),c=document.querySelector(".profile__button-data-js"),u=document.querySelector(".modal__close-editing-data-js"),m=document.querySelector(".form__input_editing-data-js");c.addEventListener("click",function(){l.classList.remove("modal_close"),m.focus()}),u.addEventListener("click",function(){l.classList.add("modal_close"),c.focus()}),window.addEventListener("keydown",function(e){l.classList.contains("modal_close")||"Escape"!==e.code||(l.classList.add("modal_close"),c.focus())});var f,v=document.querySelector(".modal_profile-delete-js"),_=document.querySelector(".profile__button-delete-js"),h=document.querySelector(".modal__close_profile-delete-js"),p=document.querySelector(".button_profile-delete-js");function w(e,t){if("formData"===t)return new FormData(e);for(var o={},n=e.querySelectorAll("input"),r=n.length,a=0;a<r;a++){var i=n[a];switch(i.type){case"file":o[i.name]=i.files;break;default:o[i.name]=i.value}}return o}function L(o){o.classList.add("form__input_good"),o.addEventListener("input",function e(t){o.classList.remove("form__input_good"),o.removeEventListener("input",e)})}_.addEventListener("click",function(){v.classList.remove("modal_close")}),h.addEventListener("click",function(){v.classList.add("modal_close"),_.focus()}),window.addEventListener("keydown",function(e){v.classList.contains("modal_close")||"Escape"!==e.code||(v.classList.add("modal_close"),_.focus())}),f=document.querySelector(".top-button"),window.addEventListener("scroll",function(){var e=window.pageYOffset;1500<e&&f.classList.add("top-button_show"),e<1500&&f.classList.remove("top-button_show")}),f.addEventListener("click",function e(){var t=window.pageYOffset/50;0<window.pageYOffset&&(window.scrollBy(0,-t),setTimeout(e,0))});var b=document.getElementById("form-profile-picture-editing-data");function g(e,t){for(var o=e.querySelectorAll("input"),n=e.querySelector(".form__label-picture"),r=o.length,a=0;a<r;a++){var i=o[a];switch(i.type){case"file":t[i.name]&&(function(e){e.classList.add("form__label-picture_bad"),b.oninput=function(){e.classList.remove("form__label-picture_bad")}}(n),S(n,t[i.name]));break;default:t[i.name]&&(function(o){o.classList.add("form__input_bad"),o.addEventListener("input",function e(t){o.classList.remove("form__input_bad"),o.removeEventListener("input",e)})}(i),S(i,t[i.name]))}}}function y(e){for(var t=e.querySelectorAll("input"),o=e.querySelector(".form__label-picture"),n=t.length,r=0;r<n;r++){var a=t[r];switch(a.type){case"file":L(o),q(o);break;default:L(a),q(a)}}}function S(o,e){var n=document.createElement("div");n.classList.add("invalid-feedback"),n.innerText=e,null==o.nextElementSibling&&(o.insertAdjacentElement("afterend",n),o.addEventListener("input",function e(t){n.remove(),o.removeEventListener("input",e)}),b.onclick=function(){n.remove()})}function q(o){var n=document.createElement("div");n.classList.add("valid-feedback"),n.innerText="All right",null==o.nextElementSibling&&(o.insertAdjacentElement("afterend",n),o.addEventListener("input",function e(t){n.remove(),o.removeEventListener("input",e)}),b.onchange=function(){n.remove()})}var E=document.querySelector(".button_modal-editing-data"),k=document.querySelector(".button_modal-password-edit");var T="https://academy.directlinedev.com";function j(e){var t=e.url,o=e.method,n=void 0===o?"GET":o,r=e.body,a=void 0===r?{}:r,i=e.headers,s={method:n,body:a,headers:void 0===i?{}:i};return"GET"===n&&(s.body=void 0),fetch(T+t,s)}var P=document.querySelector(".header__sing-in-button_js"),I=document.querySelector(".mobile-header__sing-in-button_js"),x=document.querySelector(".header__register-button_js"),M=document.querySelector(".mobile-header__register-button_js"),A=document.querySelector(".header__profile_js"),H=document.querySelector(".mobile-header__profile_js"),D=document.querySelector(".header__sing-out-button_js"),R=document.querySelector(".mobile-header__sing-out-button_js");localStorage.getItem("token")?(P.classList.add("hidden-block"),I.classList.add("hidden"),x.classList.add("hidden-block"),M.classList.add("hidden"),A.classList.remove("hidden-block"),H.classList.remove("hidden"),D.classList.remove("hidden-block"),R.classList.remove("hidden")):("/pages/profile/index.html"===window.location.pathname&&(window.location.pathname="/index.html"),P.classList.remove("hidden-block"),I.classList.remove("hidden"),x.classList.remove("hidden-block"),M.classList.remove("hidden"),A.classList.add("hidden-block"),H.classList.add("hidden"),D.classList.add("hidden-block"),R.classList.add("hidden"));var O=document.querySelector(".loader-container_js");function Y(){return'\n  <div class="loader-wrapper">\n    <div class="loader">\n      <div class="loader-line"></div>\n      <div class="loader-line"></div>\n      <div class="loader-line"></div>\n    </div>\n  </div>\n  '}var U=document.querySelector(".profile__img"),z=document.querySelector(".profile__name"),F=document.querySelector(".profile__surname"),B=document.querySelector(".profile__email"),C=document.querySelector(".profile__location"),G=document.querySelector(".profile__age");function N(){j({method:"GET",url:"/api/users/"+localStorage.getItem("userId")}).then(function(e){return e.json()}).then(function(e){z.innerHTML=e.data.name,F.innerHTML=e.data.surname,B.innerHTML=e.data.email,C.innerHTML=e.data.location,G.innerHTML=e.data.age,U.style="\n    background-image: url(".concat(T).concat(e.data.photoUrl,");\n    background-position: center;\n    background-size: cover;\n    "),e.data}).catch(function(e){alert("Information about you is not available.")})}N(),document.forms["form-password-edit"].addEventListener("submit",function(e){e.preventDefault();var t=e.target,o=w(t),n={};return null===o.oldPassword||""===o.oldPassword?(n.oldPassword="This field is required",void g(t,n)):null===o.newPassword||""===o.newPassword?(n.newPassword="This field is required",void g(t,n)):o.newPassword.length<3||20<=o.newPassword.length?(n.newPassword="Password must be between 3 and 20 characters",void g(t,n)):o.newPassword===o.oldPassword?(n.newPassword="The new password cannot be the same as the old",void g(t,n)):null===o.newPasswordRep||""===o.newPasswordRep?(n.newPasswordRep="This field is required",void g(t,n)):o.newPassword!=o.newPasswordRep?(n.newPasswordRep="New password mismatch",void g(t,n)):(O.innerHTML=Y(),void j({method:"PUT",url:"/api/users",body:w(t,"formData"),headers:{"x-access-token":localStorage.getItem("token")}}).then(function(e){return e.json()}).then(function(e){if(!e.success)throw json.errors;N(),O.innerHTML="",y(t),k.classList.add("button_good"),k.classList.remove("button_bad"),setTimeout(function(){r.classList.add("modal_close")},2e3)}).catch(function(e){O.innerHTML="",k.classList.add("button_bad"),k.classList.remove("button_good"),e.oldPassword="Forgot your password?",g(t,e)}))}),document.forms["form-editing-data"].addEventListener("submit",function(e){e.preventDefault();var t=e.target,o=w(t),n=t.querySelector(".name-js"),r=t.querySelector(".surname-js"),a=t.querySelector(".location-js"),i=t.querySelector(".age-js"),s={};return null===o.email||""===o.email?(s.email="This field is required",void g(t,s)):o.email.match(/^[0-9a-z-\.]+\@[0-9a-z-]{2,}\.[a-z]{2,}$/i)?null===o.name||""===o.name?(s.name="This field is required",void g(t,s)):parseInt(n.value)?(s.name="This name is not valid",void g(t,s)):o.name.length<3||20<=o.name.length?(s.name="Your name is too short or too long",void g(t,s)):null===o.surname||""===o.surname?(s.surname="This field is required",void g(t,s)):parseInt(r.value)?(s.surname="This surname is not valid",void g(t,s)):o.surname.length<3||20<=o.surname.length?(s.surname="Your surname is too short or too long",void g(t,s)):null===o.location||""===o.location?(s.location="This field is required",void g(t,s)):parseInt(a.value)?(s.location="This location is not valid",void g(t,s)):o.location.length<3||20<=o.location.length?(s.location="Location name is too short or too long",void g(t,s)):i.value<0||100<=i.value?(s.age="This age is not valid",void g(t,s)):null===o.age||""===o.age?(s.age="This field is required",void g(t,s)):0===o.avatar.length?(s.avatar="You forgot to choose a photo",void g(t,s)):(O.innerHTML=Y(),void j({method:"PUT",url:"/api/users",body:w(t,"formData"),headers:{"x-access-token":localStorage.getItem("token")}}).then(function(e){return e.json()}).then(function(e){if(!e.success)throw json.errors;N(),O.innerHTML="",y(t),E.classList.add("button_good"),E.classList.remove("button_bad"),setTimeout(function(){l.classList.add("modal_close")},2e3),setTimeout(function(){window.location.reload()},1e3)}).catch(function(e){O.innerHTML="",e.email="This email is already in use",e.name=null,g(t,e),E.classList.add("button_bad"),E.classList.remove("button_good")})):(s.email='Please enter a valid email address (your entry is not in the format "somebody@example.com")',void g(t,s))});var $=document.querySelector(".form__label-picture");window.FileList&&window.File&&document.getElementById("form-profile-picture-editing-data").addEventListener("change",function(e){$.innerHTML="";var t,o=i(e.target.files);try{for(o.s();!(t=o.n()).done;){var n=t.value,r=document.createElement("span"),a=n.name?n.name:"NOT SUPPORTED";r.textContent="".concat(a),$.appendChild(r)}}catch(e){o.e(e)}finally{o.f()}}),p.addEventListener("click",function(e){e.preventDefault(),j({method:"DELETE",url:"/api/users/"+localStorage.getItem("userId"),headers:{"x-access-token":localStorage.getItem("token")}}).then(function(e){return e.json()}).then(function(e){if(!e.success)throw alert("ERROR!");localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.pathname="/index.html"})});var J=document.querySelector(".header__sing-out-button_js"),K=document.querySelector(".mobile-header__sing-out-button_js");J.addEventListener("click",function(){localStorage.removeItem("token"),window.location.pathname="/index.html"}),K.addEventListener("click",function(){localStorage.removeItem("token"),window.location.pathname="/index.html"});