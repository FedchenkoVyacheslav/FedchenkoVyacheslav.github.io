"use strict";function i(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a,r=!0,i=!1;return{s:function(){o=e[Symbol.iterator]()},n:function(){var e=o.next();return r=e.done,e},e:function(e){i=!0,a=e},f:function(){try{r||null==o.return||o.return()}finally{if(i)throw a}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var e=document.querySelector(".header__mobile-menu_js"),t=document.querySelector(".mobile-header__button-close_js"),n=document.querySelector(".mobile-header");e.addEventListener("click",function(){n.classList.add("mobile-header_open")}),t.addEventListener("click",function(){n.classList.remove("mobile-header_open")});var r=document.querySelector(".modal_password-edit-js"),o=document.querySelector(".profile__button-password-js"),a=document.querySelector(".modal__close_password-edit-js"),l=document.querySelector(".form__input_sing-in-js");o.addEventListener("click",function(){r.classList.remove("modal_close"),l.focus()}),a.addEventListener("click",function(){r.classList.add("modal_close"),o.focus()}),window.addEventListener("keydown",function(e){r.classList.contains("modal_close")||"Escape"!==e.code||(r.classList.add("modal_close"),o.focus())});var d,c=document.querySelector(".modal_editing-data-js"),u=document.querySelector(".profile__button-data-js"),m=document.querySelector(".modal__close-editing-data-js"),f=document.querySelector(".form__input_editing-data-js");function v(e,t){if("formData"===t)return new FormData(e);for(var n={},o=e.querySelectorAll("input"),a=o.length,r=0;r<a;r++){var i=o[r];switch(i.type){case"file":n[i.name]=i.files;break;default:n[i.name]=i.value}}return n}u.addEventListener("click",function(){c.classList.remove("modal_close"),f.focus()}),m.addEventListener("click",function(){c.classList.add("modal_close"),u.focus()}),window.addEventListener("keydown",function(e){c.classList.contains("modal_close")||"Escape"!==e.code||(c.classList.add("modal_close"),u.focus())}),d=document.querySelector(".top-button"),window.addEventListener("scroll",function(){var e=window.pageYOffset;1500<e&&d.classList.add("top-button_show"),e<1500&&d.classList.remove("top-button_show")}),d.addEventListener("click",function e(){var t=window.pageYOffset/50;0<window.pageYOffset&&(window.scrollBy(0,-t),setTimeout(e,0))});var h=document.getElementById("form-profile-picture-editing-data");function _(e,t,n){for(var o=e.querySelectorAll("input"),a=e.querySelector(".form__label-picture"),r=o.length,i=0;i<r;i++){var s=o[i];switch(s.type){case"file":t[s.name]?(function(e){e.classList.add("form__label-picture_bad"),h.oninput=function(){e.classList.remove("form__label-picture_bad")}}(a),g(a,t[s.name])):(function(e){e.classList.add("form__label-picture_good"),h.oninput=function(){e.classList.remove("form__label-picture_good")}}(a),p(a,n[s.name]));break;default:t[s.name]?(function(n){n.classList.add("form__input_bad"),n.addEventListener("input",function e(t){n.classList.remove("form__input_bad"),n.removeEventListener("input",e)})}(s),g(s,t[s.name])):(function(n){n.classList.add("form__input_good"),n.addEventListener("input",function e(t){n.classList.remove("form__input_good"),n.removeEventListener("input",e)})}(s),p(s,n[s.name]))}}}function g(n,e){var o=document.createElement("div");o.classList.add("invalid-feedback"),o.innerText=e;var t=n.nextElementSibling;console.log(t),null==t&&(n.insertAdjacentElement("afterend",o),n.addEventListener("input",function e(t){o.remove(),n.removeEventListener("input",e)}),h.onclick=function(){o.remove()})}function p(n,e){var o=document.createElement("div");o.classList.add("valid-feedback"),o.innerText=e;var t=n.nextElementSibling;console.log(t),null==t&&(n.insertAdjacentElement("afterend",o),n.addEventListener("input",function e(t){o.remove(),n.removeEventListener("input",e)}),h.onchange=function(){o.remove()})}var b=document.querySelector(".button_modal-editing-data"),L=document.querySelector(".button_modal-password-edit");var w="https://academy.directlinedev.com";function y(e){var t=e.url,n=e.method,o=void 0===n?"GET":n,a=e.body,r=void 0===a?{}:a,i=e.headers,s={method:o,body:r,headers:void 0===i?{}:i};return"GET"===o&&(s.body=void 0),fetch(w+t,s)}var S=document.querySelector(".header__sing-in-button_js"),q=document.querySelector(".mobile-header__sing-in-button_js"),E=document.querySelector(".header__register-button_js"),T=document.querySelector(".mobile-header__register-button_js"),k=document.querySelector(".header__profile_js"),j=document.querySelector(".mobile-header__profile_js"),I=document.querySelector(".header__sing-out-button_js"),P=document.querySelector(".mobile-header__sing-out-button_js");localStorage.getItem("token")?(S.classList.add("hidden-block"),q.classList.add("hidden"),E.classList.add("hidden-block"),T.classList.add("hidden"),k.classList.remove("hidden-block"),j.classList.remove("hidden"),I.classList.remove("hidden-block"),P.classList.remove("hidden")):("/pages/profile/index.html"===window.location.pathname&&(window.location.pathname="/index.html"),S.classList.remove("hidden-block"),q.classList.remove("hidden"),E.classList.remove("hidden-block"),T.classList.remove("hidden"),k.classList.add("hidden-block"),j.classList.add("hidden"),I.classList.add("hidden-block"),P.classList.add("hidden"));var A=document.querySelector(".loader-container_js");function R(){return'\n  <div class="container-loader">\n    <div class="load-3">\n      <div class="line"></div>\n      <div class="line"></div>\n      <div class="line"></div>\n    </div>\n  </div>\n  '}var x=document.querySelector(".profile__img"),M=document.querySelector(".profile__name"),H=document.querySelector(".profile__surname"),O=document.querySelector(".profile__email"),D=document.querySelector(".profile__location"),U=document.querySelector(".profile__age");function Y(){y({method:"GET",url:"/api/users/"+localStorage.getItem("userId")}).then(function(e){return e.json()}).then(function(e){console.log(e.data),M.innerHTML=e.data.name,H.innerHTML=e.data.surname,O.innerHTML=e.data.email,D.innerHTML=e.data.location,U.innerHTML=e.data.age,x.style="\n    background-image: url(".concat(w).concat(e.data.photoUrl,");\n    background-position: center;\n    background-size: cover;\n    "),e.data}).catch(function(e){alert("Information about you is not available.")})}Y(),document.forms["form-password-edit"].addEventListener("submit",function(e){e.preventDefault(),A.innerHTML=R();var t=e.target,n=v(t);console.log(n);var o={},a={};y({method:"PUT",url:"/api/users",body:v(t,"formData"),headers:{"x-access-token":localStorage.getItem("token")}}).then(function(e){return e.json()}).then(function(e){if(!e.success)throw json.errors;Y(),A.innerHTML="",L.classList.add("button_good"),L.classList.remove("button_bad"),setTimeout(function(){r.classList.add("modal_close")},2e3)}).catch(function(e){A.innerHTML="",L.classList.add("button_bad"),L.classList.remove("button_good"),_(t,e,a),alert("ERROR!")}),null===n.oldPassword||""===n.oldPassword?o.oldPassword="This field is required":a.oldPassword="All right",null===n.newPassword||""===n.newPassword?o.newPassword="This field is required":n.password==n.newPassword?o.newPassword="The new password cannot be the same as the old":a.newPassword="All right",null===n.newPasswordRep||""===n.newPasswordRep?o.newPasswordRep="This field is required":n.newPassword!=n.newPasswordRep?o.newPasswordRep="New password mismatch":a.newPasswordRep="All right",_(t,o,a)}),document.forms["form-editing-data"].addEventListener("submit",function(e){e.preventDefault(),A.innerHTML=R();var t=e.target,n=v(t),o=t.querySelector(".name-js"),a=t.querySelector(".surname-js"),r=t.querySelector(".location-js"),i=t.querySelector(".age-js"),s={},l={};y({method:"PUT",url:"/api/users",body:v(t,"formData"),headers:{"x-access-token":localStorage.getItem("token")}}).then(function(e){return e.json()}).then(function(e){if(!e.success)throw json.errors;Y(),A.innerHTML="",b.classList.add("button_good"),b.classList.remove("button_bad"),setTimeout(function(){c.classList.add("modal_close")},2e3),setTimeout(function(){window.location.reload()},1e3)}).catch(function(e){A.innerHTML="",_(t,e,l),b.classList.add("button_bad"),b.classList.remove("button_good"),alert("ERROR!")}),null===n.email||""===n.email?s.email="This field is required":n.email.match(/^[0-9a-z-\.]+\@[0-9a-z-]{2,}\.[a-z]{2,}$/i)?l.email="All right":s.email='Please enter a valid email address (your entry is not in the format "somebody@example.com")',null===n.name||""===n.name?s.name="This field is required":parseInt(o.value)?s.name="This name is not valid":n.name.length<3||20<=n.name.length?s.name="Your name is too short or too long":l.name="All right",null===n.surname||""===n.surname?s.surname="This field is required":parseInt(a.value)?s.surname="This surname is not valid":n.surname.length<3||20<=n.surname.length?s.surname="Your surname is too short or too long":l.surname="All right",null===n.location||""===n.location?s.location="This field is required":parseInt(r.value)?s.location="This location is not valid":n.location.length<3||20<=n.location.length?s.location="Location name is too short or too long":l.location="All right",i.value<0||100<=i.value?s.age="This age is not valid":null===n.age||""===n.age?s.age="This field is required":l.age="All right",0===n.avatar.length?s.avatar="You forgot to choose a photo":l.avatar="All right",_(t,s,l)});var z=document.querySelector(".form__label-picture");window.FileList&&window.File&&document.getElementById("form-profile-picture-editing-data").addEventListener("change",function(e){z.innerHTML="";var t,n=i(e.target.files);try{for(n.s();!(t=n.n()).done;){var o=t.value,a=document.createElement("span"),r=o.name?o.name:"NOT SUPPORTED";a.textContent="".concat(r),z.appendChild(a)}}catch(e){n.e(e)}finally{n.f()}}),document.querySelector(".profile__button-delete-js").addEventListener("click",function(e){e.preventDefault(),y({method:"DELETE",url:"/api/users/"+localStorage.getItem("userId"),headers:{"x-access-token":localStorage.getItem("token")}}).then(function(e){return e.json()}).then(function(e){if(!e.success)throw alert("ERROR!");localStorage.removeItem("userId"),localStorage.removeItem("token"),alert("User successfully deleted!"),window.location.pathname="/index.html"})});var B=document.querySelector(".header__sing-out-button_js"),C=document.querySelector(".mobile-header__sing-out-button_js");B.addEventListener("click",function(){localStorage.removeItem("token"),window.location.pathname="/index.html"}),C.addEventListener("click",function(){localStorage.removeItem("token"),window.location.pathname="/index.html"});